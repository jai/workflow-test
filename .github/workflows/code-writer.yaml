name: Code Writer

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  pull-requests: write
  issues: write
  actions: read
  id-token: write

jobs:
  write-code:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          use_commit_signing: true
          additional_permissions: |
            actions: read
          claude_args: |
            --model claude-opus-4-1-20250805
            --allowedTools "mcp__github__get_me,
            mcp__github__add_comment_to_pending_review,
            mcp__github__add_pull_request_review_comment,
            mcp__github__create_issue,
            mcp__github__create_issue_comment,
            mcp__github__create_pending_pull_request_review,
            mcp__github__get_file_contents,
            mcp__github__get_pull_request_diff,
            mcp__github__submit_pending_pull_request_review,
            mcp__github__create_pull_request,
            mcp__github__create_or_update_file,
            mcp__github__delete_file,
            mcp__github__get_issue,
            mcp__github__get_issue_comments,
            mcp__github__get_pull_request,
            mcp__github__get_pull_request_comments,
            mcp__github__list_pull_request_files,
            mcp__github__list_issues,
            mcp__github__search_issues,
            mcp__github__update_issue,
            mcp__github_ci__get_ci_status,
            mcp__github_ci__get_workflow_run_details,
            mcp__github_ci__download_job_log,
            mcp__github_comment__update_claude_comment,
            mcp__github_comment__update,
            mcp__github_file_ops__commit_files,
            mcp__github_file_ops__delete_files,
            mcp__github_inline_comment__create_inline_comment,
            mcp__github_pulls__get_pull_request,
            mcp__github_pulls__list_pull_request_files,
            mcp__github_pulls__get_pull_request_diff,
            Bash,Read,Write,Edit,MultiEdit,NotebookEdit,Grep,Glob,WebFetch,WebSearch,TodoWrite"
          prompt: |
            User comment: ${{ github.event.comment.body }}
            
            Analyze the context and implement the requested changes:
            - If this is an issue, implement the solution
            - If this is a PR, make the requested changes to the PR
            
            Commit your changes with appropriate commit messages.
            The action will handle branch management automatically.